---
allowed-tools: Bash(gh:*), Bash(git:*)
description: PRの説明文を生成し、自動的にGitHubでプルリクエストを作成する
---

## コンテキスト

- 現在のGitステータス: !`git status`
- このPRでの変更内容: !`git diff main...HEAD`
- このPRに含まれるコミット: !`git log --oneline main..HEAD`
- PRテンプレート: @.github/pull_request_template.md

## あなたのタスク

指定されたオプションに基づき、現在のブランチから指定のターゲットブランチへプルリクエストを作成してください。

### オプション一覧

- **指定なし（デフォルト）**: 現在のブランチからmain or developブランチへPR作成
- **-b <ブランチ名>**: 指定したブランチをターゲットにPR作成（例: -b develop）
- **-p**: 現在のブランチをリモートへプッシュしてからPR作成
- **-u**: 既存のPRの説明文のみを更新

---

### デフォルト動作（オプション指定なし）

1. PRテンプレートのフォーマットに完全準拠した日本語のPR説明文を生成する
2. このPRで行った変更を可視化するMermaidダイアグラムを追加する
3. 現在のブランチからmain or developブランチへドラフトPRを作成: gh pr create --base main --draft --body "<生成した説明文>"

### -b オプション指定時

1. PRテンプレートに従った日本語の説明文を生成
2. Mermaidダイアグラムを追加
3. 指定されたブランチをターゲットにドラフトPRを作成: gh pr create --base <指定ブランチ> --draft --body "<生成した説明文>"

### -p オプション指定時

1. 現在のブランチをリモートへプッシュ: git push -u origin $(git branch --show-current)
2. PRテンプレートに従った日本語の説明文を生成
3. Mermaidダイアグラムを追加
4. main or developブランチへドラフトPRを作成（-bオプション併用で別ブランチ指定可能）: gh pr create --base main --draft --body "<生成した説明文>"

### -u オプション指定時

1. PRテンプレートに従った日本語の説明文を生成
2. Mermaidダイアグラムを追加
3. 既存PRの本文を更新: gh pr edit --body "<生成した説明文>"

---

## 要件

### PR説明文の生成ルール

1. PRテンプレートの構造を完全に再現すること
2. すべての説明文・コメントは日本語で記述すること
3. 実装の詳細を具体的に記載すること（どのファイルに何を変更したか、どのような機能を追加・修正したか、技術的な判断の理由）
4. テスト手順を明確に箇条書きで記載すること（具体的な確認手順、期待される結果）
5. 必ずMermaidダイアグラムを含めること
6. 内容は網羅的かつ簡潔にまとめること

### Mermaidダイアグラム作成ガイドライン

以下の要素を図示すること:
- アーキテクチャの変更点（該当する場合）
- データフローの変更点
- コンポーネント間の関係
- 変更に影響を受ける処理フロー

作成時の注意点:
- 目的に応じた図表タイプを使用する（flowchart, sequence, classDiagram, graphなど）
- 可能であれば変更前／変更後を並べて示す
- 新規または変更されたコンポーネントを明示的に強調（スタイル指定で色分け）
- 一貫したスタイル・配色を使用
- ダイアグラムはPR説明文内の「## 変更内容の可視化」などの専用セクションに配置する

---

## 実行手順

1. 変更内容とコミット履歴を分析
2. PRテンプレートに基づいた説明文を日本語で生成
3. 適切なMermaidダイアグラムを作成
4. 指定されたオプションに応じてコマンドを実行
5. 実行結果を報告

上記のルールに従い、PRの説明文を生成し、自動的にプルリクエストを作成してください。